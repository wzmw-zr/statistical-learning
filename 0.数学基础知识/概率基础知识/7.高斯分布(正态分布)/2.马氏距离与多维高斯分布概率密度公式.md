# 马氏距离与多维高斯分布概率密度公式

## 一、马氏距离

马氏距离(Mahalanobis distance)表示数据的协方差距离，是一种计算两个位置样本集的相似度的方法。

对于均值为$\mu=(\mu_1,\mu_2,...,\mu_p)^T$，协方差矩阵为$\sum$的向量$x=(x_1,x_2,...,x_p)^T$，其对应的马氏距离为：
$$
D_M(x)=\sqrt{(x-\mu)^T{\sum}^{-1}(x-\,\mu)}
$$
马氏距离考虑到了各种特征之间的联系，并且独立于测量尺度。

此外，马氏距离也可以定义为两个服从同一分布并且其协方差矩阵为$\sum$的随机变量$x$与$y$的差异化程度：
$$
d(x,y)=\sqrt{(x-y)^T{\sum}^{-1}(x-y)}
$$
如果协方差矩阵是单位矩阵，那么马氏距离就简化为欧式距离，如果协方差矩阵是对角矩阵，就称为正规化的欧式距离。
$$
d(x,y)=\sqrt{\sum_{i=1}^p\frac{(x_i-y_i)^2}{\sigma_i^2}}
$$
其中，$\sigma_i$是$x_i$的标准差。



## 二、马氏距离的意义

马氏距离是基于样本分布的一种距离，物理意义就是在规范化的主成分空间中的欧式距离。PCA会对一些数据进行主成分分解，在对所有主成分分解轴进行归一化，形成新的坐标轴。有这些坐标轴张成的空间就是规范化的主成分空间。

对于椭球分布(实际上就是下面的多维高斯分布概率密度公式)，PCA就是将椭球分布的样本改变到另一个空间里，使其成为球状分布，而马氏距离就是在样本呈球状分布的空间里所求得的欧式距离。



## 三、多维高斯分布概率密度公式

多维高斯分布的概率密度公式：
$$
f(x)=\frac{1}{(2\pi)^{\frac{p}{2}}\sum^{\frac{1}{2}}}(x-\mu)^T{\sum}^{-1}(x-\mu)
$$
其中，$x=(x_1,x_2,...,x_p)^T$，$\mu=(\mu_1,\mu_2,...\mu_p)^T$，$\sum$是协方差矩阵：
$$
\left[
\begin{matrix}
\sigma_{11} &\sigma_{12} & \cdots & \sigma_{1p}\\
\sigma_{21} &\sigma_{22} & \cdots & \sigma_{2p}\\
\vdots & \vdots &\ddots &\vdots\\
\sigma_{p1} & \sigma_{p2} &\cdots & \sigma_{pp}
\end{matrix}
\right]
$$
多维高斯分布的协方差矩阵是正定的，且对角线上都是正数(各维度方差)，其余为0()。

$(x-\mu)^T{\sum}^{-1}(x-\mu)$就是马氏距离根号内的表达式，但是马氏距离要求协方差矩阵满秩，而满秩的矩阵可以写成$\sum=UDU^T$，其中$UU^T=U^TU=E$，$D=\mathop{diag}\limits_{i=1,..,p}(\lambda_i)$，$U=(u_1,u_2,..,u_p)_{p\times p}$(满秩矩阵的性质)。

即$\sum=\sum\limits_{i = 1}^pu_i\lambda_iu_i^T$， ${\sum}^{-1}=\sum\limits_{i=1}^pu_i\frac{1}{\lambda_i}u_i^T$。

则
$$
(x-\mu)^T{\sum}^{-1}(x-\mu)=\sum_{i=1}^p(x-\mu)^Tu_i\frac{1}{\lambda_i}u_i^T(x-\mu)
$$
令$y_i = (x - \mu)^Tu_i$，则
$$
(x-\mu)^T{\sum}^{-1}(x-\mu)=\sum_{i=1}^p\frac{y_iy_i^T}{\lambda_i}=\sum_{i=1}^p\frac{y_i^2}{\lambda_i}
$$

> 高斯分布的局限性：只建立一个高斯分布通常是不合理的。

